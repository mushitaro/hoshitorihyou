# 星取表アプリケーション利用ガイド

## 1. 概要

このアプリケーションは、保全計画とその実績を管理するための星取表です。
`index.html` をブラウザで開くことで利用できます。データはブラウザのローカルストレージに自動的に保存されるため、変更内容はリロード後も維持されます。

## 2. 画面構成

- **コントロールバー**: テーブルの操作や表示設定を行うボタン群です。
- **星取表**: 保全項目と年度ごとの計画・実績が表示されます。

## 3. 基本操作

### 3.1. 階層の展開と折りたたみ

- 各項目の左側にある `▶` (展開) または `▼` (折りたたみ) アイコンをクリックすると、下位の階層の表示/非表示を切り替えられます。
- コントロールバーの「すべて展開」「すべて閉じる」ボタンで、全階層を一括で操作できます。

### 3.2. 表示設定

- コントロールバーのチェックボックスで「BOMコード」列と「周期」列の表示/非表示を切り替えられます。

### 3.3. 計画・実績の入力

1. 計画または実績を入力したい項目の、対象年度のセルをクリックします。
2. 表示されるメニューから以下のいずれかを選択します。
    - `[〇] 計画のみ`: 計画あり
    - `[●] 実績のみ`: 実績あり
    - `[〇●] 計画と実績`: 計画・実績ともにあり
    - `[ ] 削除`: 入力をクリア
3. 入力は自動的に保存され、「保存しました」という通知が表示されます。

## 4. 項目・周期の編集

### 4.1. 項目の追加

1. レベル3の項目（例：「原子炉圧力容器」）にマウスカーソルを合わせると表示される `+` アイコンをクリックします。
2. 表示されるダイアログに新しい項目名を入力し、「追加」ボタンを押します。

### 4.2. 項目名の編集

1. レベル4の項目（最下層の項目）にマウスカーソルを合わせると表示される鉛筆アイコンをクリックします。
2. 項目名が入力フィールドに変わるので、編集して `Enter` キーを押すか、フォーカスを外すと保存されます。

### 4.3. 項目の削除

1. レベル4の項目にマウスカーソルを合わせると表示されるゴミ箱アイコンをクリックします。
2. 確認ダイアログが表示されるので、「完全に削除」ボタンを押します。

### 4.4. 周期の編集

1. レベル4の項目の「周期(年)」列のセルをクリックします。
2. 入力フィールドに周期（年数）を数字で入力し、`Enter` キーを押すか、フォーカスを外すと保存されます。

## 5. 高度な機能

### 5.1. 計画の一括登録

1. 周期が設定されている項目の「周期(年)」列にマウスカーソルを合わせると、魔法の杖アイコンが表示されます。
2. アイコンをクリックすると、「計画の一括登録」ダイアログが表示されます。
3. 「開始年度」を選択し、「実行」ボタンを押すと、その年度から指定された周期で計画（〇）が自動的に入力されます。
    - **既存の計画を上書きする場合**: 「指定年度以降の計画をリセットして再作成する」にチェックを入れてください。

### 5.2. 年度操作

コントロールバーの「年度操作」メニューから年度の追加・削除ができます。

- **追加**: 新しい年度を4桁の数字で入力します。
- **削除**: 削除したい年度を選択します。計画や実績が入力されている年度は削除できません。

### 5.3. データ操作

コントロールバーの「データ操作」メニューから以下の操作ができます。

- **エクスポート (JSON)**: 現在の星取表のデータを `hoshitori_data.json` という名前のファイルでダウンロードします。
- **インポート (JSON)**: JSONファイルを選択して、データを読み込みます。現在のデータは上書きされます。
- **データを初期化**: すべてのデータを最初の状態に戻します。

### 5.4. 検索

- コントロールバー右上の検索ボックスにキーワードを入力すると、「実施項目」がそのキーワードを含む行のみに絞り込んで表示されます。

## 6. データ構造

データはJSON形式で管理されています。インポート/エクスポート機能で利用するファイルの形式は以下の通りです。

- `testdata.json` がその一例です。
- `years`: 年度を管理する配列 (例: `[2024, 2025]`)
- `maintenanceData`: 項目データを管理する配列。各項目は `children` プロパティを持つことで階層構造を表現します。

```json
{
  "years": [2020, 2021, 2022, 2023, 2024, 2025],
  "maintenanceData": [
    {
      "id": 1,
      "task": "原子炉施設",
      "level": 1,
      "children": [
        {
          "id": 2,
          "task": "原子炉本体",
          "level": 2,
          "children": [
            {
              "id": 4,
              "task": "圧力容器の開放点検",
              "level": 4,
              "cycle": 2,
              "results": {
                "2020": { "planned": true, "actual": true },
                "2022": { "planned": true, "actual": false }
              }
            }
          ]
        }
      ]
    }
  ]
}
```
